<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>使用sar工具查看系统瓶颈</title>
      <link href="/2019/07/29/%E4%BD%BF%E7%94%A8sar%E5%B7%A5%E5%85%B7%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E7%93%B6%E9%A2%88/"/>
      <url>/2019/07/29/%E4%BD%BF%E7%94%A8sar%E5%B7%A5%E5%85%B7%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E7%93%B6%E9%A2%88/</url>
      
        <content type="html"><![CDATA[<h3>安装sar工具及enable</h3><ul><li><p>安装sar工具</p><p><code>yum install sysstat</code></p></li><li><p>修改配置打开sar</p><p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/<span class="keyword">default</span>/sysstat <span class="comment">//ubuntu、centos应该安装直接可以使用</span></span><br><span class="line">ENABLED=<span class="string">"true"</span> <span class="comment">//打开sysstat的log   </span></span><br><span class="line"># Default settings for /etc/init.d/sysstat, /etc/cron.d/sysstat</span><br><span class="line"># and /etc/cron.daily/sysstat files</span><br></pre></td></tr></table></figure></p></li><li><p>查看crontab的内容<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@localhost ~]# cat /etc/cron.d/sysstat</span><br><span class="line"># Run system activity accounting tool every 10 minutes</span><br><span class="line">*<span class="regexp">/10 * * * * root /u</span>sr/lib64/sa/sa1 <span class="number">1</span> <span class="number">1</span></span><br><span class="line"># 0 * * * * root /usr/lib64/sa/sa1 600 6 &amp;</span><br><span class="line"># Generate a daily summary of process accounting at 23:53</span><br><span class="line"><span class="number">53</span> <span class="number">23</span> * * * root /usr/lib64/sa/sa2 -A</span><br></pre></td></tr></table></figure></p></li></ul><h3>使用sar工具</h3><ul><li><p>查看cpu使用率</p><p><code>sar -u</code></p><p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Linux <span class="number">4.18</span><span class="number">.0</span><span class="number">-25</span>-generic (zjp)   <span class="number">2019</span>年<span class="number">07</span>月<span class="number">24</span>日  _x86_64_        (<span class="number">4</span>CPU)</span><br><span class="line"><span class="number">00</span>时<span class="number">00</span>分<span class="number">01</span>秒     CPU     %user     %nice   %system   %iowait    %steal     %idle</span><br><span class="line"><span class="number">00</span>时<span class="number">05</span>分<span class="number">01</span>秒     all      <span class="number">6.90</span>      <span class="number">0.01</span>      <span class="number">3.31</span>      <span class="number">0.62</span>      <span class="number">0.00</span>     <span class="number">89.16</span></span><br><span class="line"><span class="number">00</span>时<span class="number">15</span>分<span class="number">01</span>秒     all      <span class="number">7.33</span>      <span class="number">0.00</span>      <span class="number">3.46</span>      <span class="number">0.76</span>      <span class="number">0.00</span>     <span class="number">88.44</span> </span><br><span class="line"><span class="number">00</span>时<span class="number">25</span>分<span class="number">01</span>秒     all      <span class="number">6.88</span>      <span class="number">0.00</span>      <span class="number">3.30</span>      <span class="number">0.54</span>      <span class="number">0.00</span>     <span class="number">89.27</span></span><br><span class="line"><span class="number">00</span>时<span class="number">35</span>分<span class="number">01</span>秒     all      <span class="number">6.91</span>      <span class="number">0.00</span>      <span class="number">3.31</span>      <span class="number">0.55</span>      <span class="number">0.00</span>     <span class="number">89.23</span></span><br><span class="line"><span class="number">00</span>时<span class="number">45</span>分<span class="number">01</span>秒     all      <span class="number">6.91</span>      <span class="number">0.00</span>      <span class="number">3.28</span>      <span class="number">0.52</span>      <span class="number">0.00</span>     <span class="number">89.29</span></span><br><span class="line"><span class="number">00</span>时<span class="number">55</span>分<span class="number">01</span>秒     all      <span class="number">6.92</span>      <span class="number">0.00</span>      <span class="number">3.26</span>      <span class="number">0.48</span>      <span class="number">0.00</span>     <span class="number">89.35</span></span><br><span class="line"><span class="number">01</span>时<span class="number">05</span>分<span class="number">01</span>秒     all      <span class="number">7.07</span>      <span class="number">0.00</span>      <span class="number">3.36</span>      <span class="number">0.56</span>      <span class="number">0.00</span>     <span class="number">89.01</span></span><br><span class="line"><span class="number">01</span>时<span class="number">15</span>分<span class="number">01</span>秒     all      <span class="number">7.42</span>      <span class="number">0.00</span>      <span class="number">3.42</span>      <span class="number">0.55</span>      <span class="number">0.00</span>     <span class="number">88.61</span></span><br><span class="line"><span class="number">01</span>时<span class="number">25</span>分<span class="number">01</span>秒     all      <span class="number">6.86</span>      <span class="number">0.00</span>      <span class="number">3.28</span>      <span class="number">0.55</span>      <span class="number">0.00</span>     <span class="number">89.31</span></span><br></pre></td></tr></table></figure></p></li><li><p>看平均负载情况</p><p><code>sar -q</code></p><p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">• runq-sz：运行队列的长度（等待运行的进程数）</span><br><span class="line">• plist-sz：进程列表中进程（processes）和线程（threads）的数量</span><br></pre></td></tr></table></figure></p><p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00</span>时<span class="number">00</span>分<span class="number">01</span>秒   runq-sz  plist-sz   ldavg<span class="number">-1</span>   ldavg<span class="number">-5</span>  ldavg<span class="number">-15</span>   blocked</span><br><span class="line"><span class="number">00</span>时<span class="number">05</span>分<span class="number">01</span>秒         <span class="number">0</span>      <span class="number">1393</span>      <span class="number">0.95</span>      <span class="number">0.64</span>      <span class="number">0.79</span>         <span class="number">0</span></span><br><span class="line"><span class="number">00</span>时<span class="number">15</span>分<span class="number">01</span>秒         <span class="number">0</span>      <span class="number">1385</span>      <span class="number">0.56</span>      <span class="number">0.60</span>      <span class="number">0.73</span>         <span class="number">0</span></span><br><span class="line"><span class="number">00</span>时<span class="number">25</span>分<span class="number">01</span>秒         <span class="number">0</span>      <span class="number">1382</span>      <span class="number">0.64</span>      <span class="number">0.45</span>      <span class="number">0.56</span>         <span class="number">0</span></span><br><span class="line"><span class="number">00</span>时<span class="number">35</span>分<span class="number">01</span>秒         <span class="number">2</span>      <span class="number">1382</span>      <span class="number">0.18</span>      <span class="number">0.41</span>      <span class="number">0.52</span>         <span class="number">0</span></span><br><span class="line"><span class="number">00</span>时<span class="number">45</span>分<span class="number">01</span>秒         <span class="number">0</span>      <span class="number">1383</span>      <span class="number">0.48</span>      <span class="number">0.45</span>      <span class="number">0.46</span>         <span class="number">0</span></span><br><span class="line"><span class="number">00</span>时<span class="number">55</span>分<span class="number">01</span>秒         <span class="number">0</span>      <span class="number">1386</span>      <span class="number">0.20</span>      <span class="number">0.40</span>      <span class="number">0.45</span>         <span class="number">0</span></span><br></pre></td></tr></table></figure></p></li></ul><ul><li><p>查看内存负载</p><p><code>sar -r</code></p><p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">• kbmemfree：这个值和free命令中的free值基本一致,所以它不包括buffer和cache的空间.</span><br><span class="line">• kbmemused：这个值和free命令中的used值基本一致,所以它包括buffer和cache的空间.</span><br><span class="line">• %memused：物理内存使用率，这个值是kbmemused和内存总量(不包括swap)的一个百分比.</span><br><span class="line">• kbbuffers和kbcached：这两个值就是free命令中的buffer和cache.</span><br><span class="line">• kbcommit：保证当前系统所需要的内存,即为了确保不溢出而需要的内存(RAM+swap).</span><br><span class="line">• %commit：这个值是kbcommit与内存总量(包括swap)的一个百分比.</span><br></pre></td></tr></table></figure></p><p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">00</span>时<span class="number">00</span>分<span class="number">01</span>秒 kbmemfree   kbavail kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty</span><br><span class="line"><span class="number">00</span>时<span class="number">05</span>分<span class="number">01</span>秒    <span class="number">309480</span>   <span class="number">4421376</span>  <span class="number">10045476</span>     <span class="number">62.36</span>    <span class="number">527648</span>   <span class="number">4788684</span>  <span class="number">25121556</span>    <span class="number">137.98</span>  <span class="number">11523384</span>   <span class="number">3479648</span>       <span class="number">684</span></span><br><span class="line"><span class="number">00</span>时<span class="number">15</span>分<span class="number">01</span>秒    <span class="number">288948</span>   <span class="number">4446896</span>  <span class="number">10019880</span>     <span class="number">62.20</span>    <span class="number">532212</span>   <span class="number">4818928</span>  <span class="number">25079040</span>    <span class="number">137.75</span>  <span class="number">11514952</span>   <span class="number">3498364</span>      <span class="number">3236</span></span><br><span class="line"><span class="number">00</span>时<span class="number">25</span>分<span class="number">01</span>秒    <span class="number">276680</span>   <span class="number">4432124</span>  <span class="number">10034676</span>     <span class="number">62.29</span>    <span class="number">532960</span>   <span class="number">4815592</span>  <span class="number">25109912</span>    <span class="number">137.92</span>  <span class="number">11529264</span>   <span class="number">3495020</span>       <span class="number">628</span></span><br><span class="line"><span class="number">00</span>时<span class="number">35</span>分<span class="number">01</span>秒    <span class="number">271228</span>   <span class="number">4427648</span>  <span class="number">10039176</span>     <span class="number">62.32</span>    <span class="number">533760</span>   <span class="number">4815756</span>  <span class="number">25108224</span>    <span class="number">137.91</span>  <span class="number">11534788</span>   <span class="number">3495208</span>       <span class="number">500</span></span><br><span class="line"><span class="number">00</span>时<span class="number">45</span>分<span class="number">01</span>秒    <span class="number">274180</span>   <span class="number">4431408</span>  <span class="number">10035484</span>     <span class="number">62.30</span>    <span class="number">534500</span>   <span class="number">4815872</span>  <span class="number">25116144</span>    <span class="number">137.95</span>  <span class="number">11531552</span>   <span class="number">3495324</span>       <span class="number">508</span></span><br><span class="line"><span class="number">00</span>时<span class="number">55</span>分<span class="number">01</span>秒    <span class="number">244844</span>   <span class="number">4402908</span>  <span class="number">10064140</span>     <span class="number">62.47</span>    <span class="number">535212</span>   <span class="number">4815844</span>  <span class="number">25179352</span>    <span class="number">138.30</span>  <span class="number">11560284</span>   <span class="number">3495296</span>       <span class="number">712</span></span><br><span class="line"><span class="number">01</span>时<span class="number">05</span>分<span class="number">01</span>秒    <span class="number">236672</span>   <span class="number">4398960</span>  <span class="number">10066640</span>     <span class="number">62.49</span>    <span class="number">536036</span>   <span class="number">4819632</span>  <span class="number">25187996</span>    <span class="number">138.35</span>  <span class="number">11565192</span>   <span class="number">3497772</span>       <span class="number">652</span></span><br><span class="line"><span class="number">01</span>时<span class="number">15</span>分<span class="number">01</span>秒   <span class="number">1067352</span>   <span class="number">5237928</span>   <span class="number">9263644</span>     <span class="number">57.51</span>    <span class="number">536896</span>   <span class="number">4793184</span>  <span class="number">23676896</span>    <span class="number">130.05</span>  <span class="number">10816624</span>   <span class="number">3453844</span>       <span class="number">188</span></span><br><span class="line"><span class="number">01</span>时<span class="number">25</span>分<span class="number">01</span>秒   <span class="number">1096936</span>   <span class="number">5255868</span>   <span class="number">9246896</span>     <span class="number">57.40</span>    <span class="number">537688</span>   <span class="number">4779960</span>  <span class="number">23681252</span>    <span class="number">130.07</span>  <span class="number">10800492</span>   <span class="number">3440624</span>       <span class="number">640</span></span><br></pre></td></tr></table></figure></p></li><li><p>查看内存页面交换情况</p><p><code>sar -W</code></p><p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">• pswpin/s：每秒系统换入的交换页面（swap page）数量</span><br><span class="line">• pswpout/s：每秒系统换出的交换页面（swap page）数量</span><br></pre></td></tr></table></figure></p><p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00</span>时<span class="number">00</span>分<span class="number">01</span>秒  pswpin/s pswpout/s</span><br><span class="line"><span class="number">00</span>时<span class="number">05</span>分<span class="number">01</span>秒      <span class="number">0.00</span>      <span class="number">0.00</span></span><br><span class="line"><span class="number">00</span>时<span class="number">15</span>分<span class="number">01</span>秒      <span class="number">0.00</span>      <span class="number">0.00</span></span><br><span class="line"><span class="number">00</span>时<span class="number">25</span>分<span class="number">01</span>秒      <span class="number">0.00</span>      <span class="number">0.00</span></span><br></pre></td></tr></table></figure></p></li><li><p>查看内存的情况</p><p><code>sar -B</code></p><p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">•pgpgin ：系统每秒从磁盘置入的page（<span class="number">1000</span>字节） system paged <span class="keyword">in</span> <span class="keyword">from</span> disk per second</span><br><span class="line">•pgpgout：系统每秒置出磁盘的page（<span class="number">1000</span>字节） system paged out to disk per second</span><br><span class="line">•pgscank：系统每秒扫描的swap page（<span class="number">1000</span>字节） <span class="built_in">Number</span> <span class="keyword">of</span> pages scanned by the kswapd daemon per second</span><br><span class="line">•pgscand：系统每秒扫描的directy page（<span class="number">1000</span>字节） <span class="built_in">Number</span> <span class="keyword">of</span> pages scanned directly per second</span><br><span class="line">•pgsteal：系统每秒为满足系统要求的回收的缓存（pagecache和swapcache）（<span class="number">1000</span>字节） <span class="built_in">Number</span> <span class="keyword">of</span> pages the system has reclaimed <span class="keyword">from</span> cache (pagecache and swapcache) per second to satisfy its memory demands</span><br><span class="line">•vmeff  ： Calculated <span class="keyword">as</span> pgsteal / pgscan（pgscand+pgscank）回收率</span><br></pre></td></tr></table></figure></p><p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>时<span class="number">35</span>分<span class="number">01</span>秒  pgpgin/s pgpgout/s   fault/s  majflt/s  pgfree/s pgscank/s pgscand/s pgsteal/s    %vmeff</span><br><span class="line"><span class="number">13</span>时<span class="number">15</span>分<span class="number">01</span>秒      <span class="number">0.41</span>    <span class="number">122.04</span>   <span class="number">3659.54</span>      <span class="number">0.01</span>   <span class="number">3587.59</span>      <span class="number">5.31</span>      <span class="number">1.99</span>      <span class="number">5.32</span>     <span class="number">72.98</span></span><br><span class="line"><span class="number">13</span>时<span class="number">25</span>分<span class="number">01</span>秒      <span class="number">0.00</span>     <span class="number">78.42</span>   <span class="number">2751.88</span>      <span class="number">0.00</span>   <span class="number">2671.17</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></span><br><span class="line"><span class="number">13</span>时<span class="number">35</span>分<span class="number">01</span>秒     <span class="number">13.66</span>    <span class="number">214.42</span>   <span class="number">5310.88</span>      <span class="number">0.13</span>   <span class="number">5383.70</span>    <span class="number">190.40</span>      <span class="number">0.00</span>    <span class="number">136.98</span>     <span class="number">71.94</span></span><br><span class="line"><span class="number">13</span>时<span class="number">45</span>分<span class="number">01</span>秒      <span class="number">7.33</span>     <span class="number">82.70</span>   <span class="number">3361.57</span>      <span class="number">0.01</span>   <span class="number">3336.64</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></span><br><span class="line"><span class="number">13</span>时<span class="number">55</span>分<span class="number">01</span>秒     <span class="number">38.54</span>    <span class="number">272.99</span>   <span class="number">6832.67</span>      <span class="number">0.18</span>   <span class="number">6735.06</span>    <span class="number">221.14</span>      <span class="number">0.00</span>    <span class="number">170.69</span>     <span class="number">77.19</span></span><br><span class="line"><span class="number">14</span>时<span class="number">05</span>分<span class="number">01</span>秒     <span class="number">91.70</span>    <span class="number">103.20</span>   <span class="number">3757.22</span>      <span class="number">0.22</span>   <span class="number">4418.68</span>     <span class="number">68.53</span>      <span class="number">0.00</span>     <span class="number">39.40</span>     <span class="number">57.49</span></span><br><span class="line"><span class="number">14</span>时<span class="number">15</span>分<span class="number">01</span>秒     <span class="number">25.21</span>    <span class="number">123.22</span>   <span class="number">4489.15</span>      <span class="number">0.06</span>   <span class="number">4958.97</span>     <span class="number">59.77</span>      <span class="number">5.88</span>     <span class="number">47.79</span>     <span class="number">72.79</span></span><br><span class="line"><span class="number">14</span>时<span class="number">25</span>分<span class="number">01</span>秒     <span class="number">48.40</span>     <span class="number">65.09</span>   <span class="number">3389.68</span>      <span class="number">0.62</span>   <span class="number">3779.18</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></span><br></pre></td></tr></table></figure></p></li><li><p>查看IO的情况</p><p><code>sar -b</code></p><p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">tps</span><br><span class="line">Total  number  <span class="keyword">of</span> transfers per second that were issued to physical devices.  A transfer is an I/O request to a physical device. Multiple logical requests can be combined into a single     </span><br><span class="line">I/O request to the device.  A transfer is <span class="keyword">of</span> indeterminate size.</span><br><span class="line"></span><br><span class="line">rtps</span><br><span class="line">Total number <span class="keyword">of</span> read requests per second issued to physical devices.</span><br><span class="line"></span><br><span class="line">wtps</span><br><span class="line">Total number <span class="keyword">of</span> write requests per second issued to physical devices.</span><br><span class="line"></span><br><span class="line">bread/s</span><br><span class="line">Total amount <span class="keyword">of</span> data read <span class="keyword">from</span> the devices <span class="keyword">in</span> blocks per second.  Blocks are equivalent to sectors and therefore have a size <span class="keyword">of</span> <span class="number">512</span> bytes.</span><br><span class="line"></span><br><span class="line">bwrtn/s</span><br><span class="line">Total amount <span class="keyword">of</span> data written to devices <span class="keyword">in</span> blocks per second.</span><br></pre></td></tr></table></figure></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 内核工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kernel,sar </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
